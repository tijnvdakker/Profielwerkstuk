<!DOCTYPE html> 
<html>
    <head>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js" integrity="sha512-aVKKRRi/Q/YV+4mjoKBsE4x3H+BkegoM/em46NNlCqNTmUYADjBbeNefNxYV7giUp0VxICtqdrbqU7iVaeZNXA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    </head>
    <body>
        <form method="post" action="/train_and_test">
            <input type="number" name="trainingAmount">
            <input type="number" name="testAmount">
            <input type="submit" value="Train en test">
        </form>

        <button id="submit-drawing">Submit</button>

        <script>
            var canvas = document.createElement('canvas');
            var hiddenCanvas = document.createElement('canvas');
            canvas.width = "560";
            canvas.height = "560";
            hiddenCanvas.width = "28";
            hiddenCanvas.height = "28";
            hiddenCanvas.style.float = 'right';
            hiddenCanvas.style.background = 'black';
            canvas.style.background = 'black';
            document.body.appendChild(canvas);
            document.body.appendChild(hiddenCanvas);

            document.body.style.margin = 0;
            canvas.style.position = 'fixed';

            var ctx = canvas.getContext('2d');
            var ctxHidden = hiddenCanvas.getContext('2d');

            var pos = { x: 0, y: 0 };

            document.addEventListener('mousemove', draw);
            document.addEventListener('mousedown', setPosition);
            document.addEventListener('mouseenter', setPosition);

            // new position from mouse event
            function setPosition(e) {
                pos.x = e.clientX;
                pos.y = e.clientY;
            }

            function draw(e) {
                // mouse left button must be pressed
                if (e.buttons !== 1) return;

                ctx.beginPath(); // begin

                ctx.lineWidth = 80;
                ctx.lineCap = 'round';
                ctx.strokeStyle = 'white';

                ctx.moveTo(pos.x, pos.y); // from
                setPosition(e);
                ctx.lineTo(pos.x, pos.y); // to

                ctx.stroke(); // draw it!
            }

            $('#submit-drawing').on('click', (e) => {
                e.preventDefault();

                ctxHidden.drawImage(canvas,0,0,560,560,0,0,28,28);

                let data = Array.from(ctxHidden.getImageData(0, 0, 28, 28).data);
                let brightnessValues = [];

                for (let i = 0; i < data.length; i += 4) {
                    brightnessValues.push(data[i + 3] / 255);
                }

                console.log(brightnessValues);
                
                $.ajax({
                    url: '/predict',
                    type: 'POST',
                    data: JSON.stringify(brightnessValues),
                    contentType: "application/json",
                    processData: false,
                    success: function(data){
                        console.log(data);
                    }
                });
            });
        </script>
    </body>
</html>